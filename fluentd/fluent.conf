<system>
  log_level "#{ENV['LOG_LEVEL']}"
</system>

<source> 
  @type tail 
  path /var/log/application/*.json.log
  pos_file /var/log/application/newrelic.pos
  tag newrelic.application
  <parse> 
    @type json 
  </parse>
</source>

<filter newrelic.application>
  @type record_transformer
  <record>
    hostname "#{Socket.gethostname}"
  </record>
</filter>

<match newrelic.application> 
  @type newrelic 
  api_key "#{ENV['API_KEY']}"
  base_uri "#{ENV['BASE_URI']}"
</match>

<label @FLUENT_LOG>
  <filter fluent.*>
    @type record_transformer
    <record>
      fluentd_host "#{Socket.gethostname}"
    </record>
  </filter>
  <match fluent.*>
    @type stdout
  </match>
</label>
